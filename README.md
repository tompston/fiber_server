# Golang Fiber REST API template

## Current setup

- docker-compose version for deployment

  - Not tested on a real server. Need to configure more

- Ent ORM
  - Model for user (Located in ./ent/schema/user.go)
  - Model for post (Located in ./ent/schema/post.go)
- Postgres connection possible with sqlx, sql or ent packages
- Load .env variables
  - all variables with settings.LoadEnvFile()
  - a single variable with settings.Config("VARIABLE_NAME")
- Custom response handler (Located in ./utils/response)
- auto refresh on code change with fresh
- Authentication
  - User registration + hashed password
  - JWT with custom payloads
    - can generate access and refresh tokens individually (check ./utils/auth)
  - Google Oauth (not finished)
- API endpoints defined in ./router/router.go

## Notes

- Jwt authentication flow is not fully implemented. No new cookies are generated when the access token expires. Open to contribution
- Google oauth thing is not connected to auth system, didn't figure out how that stuff works fully

## How to run the server

### Locally

        1. change the .env.example to .env and define the variables
        2. go get github.com/pilu/fresh && go mod download
        3. fresh
        4. import the postman json file to use the api
        # possibly need to visit http://localhost:3000/migrate to migrate the db

### Production

        # not tested, most probably errors. Fix later
        1. change the .env.example to .env and define the variables
        2. docker-compose up -d

# Notes for Ent

[Documentation Link](https://entgo.io/docs/getting-started)

    # Creating new models
    go run entgo.io/ent/cmd/ent init MyTableName

    # How do migrations work, when making changes in the ent folder?
    1. run go generate ./ent
    2. visit http://localhost:3000/migrate

# File structure explained

        │   main.go                     // main config for the server
        ├───controllers                 // holds views for the models
        ├───ent                         // folder generated by ent
        ├───middleware
        │       is_authenticated.go     // checks if the user is authenticated middleware
        ├───router                      // router for views
        ├───settings
        │   │   settings.go             // holds the function for loading .env files + define jwt expiration times
        │   └───database                // holds the mentioned db connection functions
        └───utils
        ├───auth                        // holds functions resposible for authentication
        │       jwt_generate.go         // generate the jwt cookies.
        │       jwt_request_token.go    // request the cookie that holds the jwt. Need to pass the name of the cookie to the function
        │       jwt_validate.go         // holds 2 functions. RequestUserId returns the id of the user from the jwt. IsAuthenticated returns a boolean to check if the jwt is still valid
        │       oauth.go                // uses goth_fiber ( wrapper for goth library)
        └───response                    // holds the defined responses so that there is some structure for the api

## Todos

- Change all routes to have the predefined respose

- Test the docker-container version later in vm
- Write down how to cd into the psql shell from docker
  <!-- https://stackoverflow.com/questions/27673563/how-to-get-into-psql-of-a-running-postgres-container -->
- Test the routes to check possible errors. Especially the auth stuff
- Figure out how to pass the time as a env variable in settings.go
- Check out the ent graphql extenstion + blog posts
